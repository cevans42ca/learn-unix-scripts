.PHONY: clean

include config.status
G_UID=10000

run: build
	docker run -it --rm --mount src=lus,target=/mnt/vol --env DARK_MODE=$(DARK_MODE) learn-unix

#Notes for shared, encrypted directories
#docker run -it --rm --mount source=vol,target=/mnt/vol --cap-add SYS_ADMIN --device /dev/fuse alpine

flags/buildtarget: bin/* etc-profile.sh Dockerfile launch.sh
	docker build -t learn-unix --build-arg D_UID=1001 --build-arg D_USERNAME=duser1 --build-arg D_GID=$(G_UID) .
	touch flags/buildtarget

build: flags/buildtarget

flags/volumetarget:
	docker volume create lus
	touch flags/volumetarget

createvolume: flags/volumetarget

createuservolume: createvolume
	docker run --rm --mount src=lus,target=/mnt/vol -u 0 learn-unix /bin/bash -c 'mkdir -p /mnt/vol/testuser;chgrp ${G_UID} /mnt/vol/testuser;chmod g+w /mnt/vol/testuser'

createsharedvolume: createvolume
	docker run --rm --mount src=lus,target=/mnt/vol -u 0 learn-unix /bin/bash -c 'mkdir -p /mnt/vol/shared;chgrp ${G_UID} /mnt/vol/shared;chmod g+w /mnt/vol/shared;chmod +t /mnt/vol/shared'

clean:
	rm -f flags/buildtarget
	rm -f flags/volumetarget

